import{K as C,u as t}from"./index-2Uo9qjFZ.js";import{c as P,p as se,_ as ce,b as K,E as Q,y as N,N as he,m as oe}from"./CGen-8GSN223x-BnRzQ8tt.js";const le=(r,e,h)=>{const s=[];if(!e||e.length===0){for(const c of r)(!h||!h.includes(c.index))&&s.push(c);return s}for(const c of r)c.name&&(c.name.includes(e)||c.search.includes(`${e} `))&&(!h||!h.includes(c.index))&&s.push(c);return s},ae=(r,e)=>{const h=[];if(e)for(const s of e)h.push(r[s]);return h},de=(r,e)=>{const h=Math.pow(2,e)-1,s=new DataView(r),c=e/8;let u=Math.ceil(s.byteLength/4*c);const o=new Uint8ClampedArray(u);let f=0,i=0,l=0;for(let d=0;d<s.byteLength;d+=4){const $=s.getUint8(d+3);if(e===8){o[f++]=$;continue}const j=$/255,n=Math.round(h*j);switch(e){case 1:{i<<=1,i|=n,++l===8&&(l=0,o[f++]=i,i=0);continue}case 2:{i<<=2,i|=n,(l+=2)===8&&(l=0,o[f++]=i,i=0);continue}case 4:{i<<=4,i|=n,(l+=4)===8&&(l=0,o[f++]=i,i=0);continue}}throw new Error("Unsupported bit depth")}return f<o.length-1&&(o[f]=i),o.buffer},pe=(r,e,h,s,c,u)=>new Promise((o,f)=>{let i=1;s&&s>0&&e>s&&(i=s/e),c&&c>0&&h*i>c&&(i=c/h);const l=new TextEncoder().encode(r),d=new Blob([l.buffer],{type:"image/svg+xml"}),$=URL.createObjectURL(d),j=new Image(Math.ceil(e*i),Math.ceil(h*i)),n=document.createElement("canvas");n.width=Math.ceil(e*i),n.height=Math.ceil(h*i);const b=n.getContext("2d");j.onload=()=>{b.drawImage(j,0,0);const p=b.getImageData(0,0,Math.ceil(e*i),Math.ceil(h*i));URL.revokeObjectURL($),o({width:Math.ceil(e*i),height:Math.ceil(h*i),bitmap:de(p.data.buffer,u)})},j.onerror=()=>{URL.revokeObjectURL($),f("Unable to load image")},j.src=$}),H=(r,e,h)=>{if(h&&h>0){const s=h/r.height;return{width:Math.ceil(r.width*s),height:h,scale:s}}else if(e&&e>0){const s=e/r.width;return{width:e,height:Math.ceil(r.height*s),scale:s}}else throw new Error("clampWidth or clampHeight must be specified")},ge=(r,e,h,s,c)=>{let u=0;for(let o=0;o<e.length;++o){const f=r[e[o]];!c&&!s&&(s=32);const i=H(f,c,s);u+=Math.ceil(i.width*i.height*h/8)}return u},ue=r=>{let e={flex:"auto 0 0"},h=r.clampWidth,s=r.clampHeight;!h&&!s&&(s=32);const c=H(r.icon,h,s);return e.width=`${c.width}px`,e.height=`${c.height}px`,t.jsx(t.Fragment,{children:t.jsx("div",{style:{overflow:"hidden",padding:"1% 1% 1% 1%"},children:t.jsxs("center",{children:[t.jsx("div",{dangerouslySetInnerHTML:{__html:r.icon.svg},style:e}),t.jsxs("label",{className:"inputButtonCheckLabel",style:{width:"80%",overflowY:"hidden"},children:[t.jsx("input",{type:"checkbox",className:"inputButtonCheck",checked:r.checked,onChange:r.onChange}),r.icon.label]})]})})})},Z=(r,e)=>{let h=1,s=e;for(;r.has(s);)s=`${e}${++h}`;return r.set(s,s),s},A=async(r,e,h,s,c,u,o,f)=>{const i=new Map,l=o!=null&&o.length>0&&o!="C",d=N(h),$=d.toUpperCase()+(l?"_HPP":"_H"),j=d.toUpperCase()+"_IMPLEMENTATION";let n=`// Automatically generated by https://honeythecodewitch.com/gfx/icon-pack\r
`;n+=`// #define ${j} in exactly one\r
`;let b=".c/.cpp";l&&(b=".cpp"),n+=`// translation unit (${b} file) before including this header\r
`,n+=`#ifndef ${$}\r
`,n+=`#define ${$}\r
`,n+=`#include <stdint.h>\r
`,l&&(n+=`#include <stddef.h>\r
`,s>0?n+=`#include "gfx_pixel.hpp"\r
#include "gfx_bitmap.hpp"\r
`:n+=`#include "gfx_core.hpp"\r
#include "gfx_positioning.hpp"\r
`),n+=`\r
`,l?(s>0&&(n+=`constexpr static const size_t ${d}_bit_depth = ${s};\r
`),c&&c>0?n+=`constexpr static const uint16_t ${d}_height = ${c};\r
`:u&&u>0?n+=`constexpr static const uint16_t ${d}_width = ${u};\r
`:(c=32,n+=`constexpr static const uint16_t ${d}_height = ${c};\r
`)):(s>0&&(n+=`#define ${d.toUpperCase()}_BIT_DEPTH ${s}\r
`),c&&c>0?n+=`#define ${d.toUpperCase()}_HEIGHT ${c}\r
`:u&&u>0?n+=`#define ${d.toUpperCase()}_WIDTH ${u}\r
`:(c=32,n+=`#define ${d.toUpperCase()}_HEIGHT ${c}\r
`)),n+=`\r
`;for(let p=0;p<e.length;++p){const g=r[e[p]],x=H(g,u,c),w=Z(i,N(`${h}_${g.name}`));l||(s==0?(n+=`#define ${w.toUpperCase()}_DIMENSIONS {${g.width}, ${g.height}}\r
`,n+=`#define ${w.toUpperCase()}_SCALED_DIMENSIONS {${x.width}, ${x.height}}\r
`,n+=`#define ${w.toUpperCase()}_SCALE (${x.scale})\r
`):n+=`#define ${w.toUpperCase()}_DIMENSIONS {${x.width}, ${x.height}}\r
`,n+=`#ifdef __cplusplus\r
extern "C"\r
#else\r
extern\r
#endif\r
`),s>0?(n+=`/// @brief "${g.label}" - a ${x.width}x${x.height} alpha transparency map\r
`,l?n+=`const gfx::const_bitmap<gfx::alpha_pixel<${s}>> ${w};\r
`:n+=`const uint8_t ${w}[];\r
`):(l&&(n+=`/// @brief "${g.label}" dimensions\r
`,n+=`constexpr static const gfx::sizef ${w}_dimensions(${g.width},${g.height});\r
`,n+=`/// @brief "${g.label}" scaled dimensions\r
`,n+=`constexpr static const gfx::size16 ${w}_scaled_dimensions(${x.width},${x.height});\r
`,n+=`/// @brief "${g.label}" target scale\r
`,n+=`constexpr static const float ${w}_scale = ${x.scale};\r
`),n+=`/// @brief "${g.label}" - a SVG vector icon\r
`,l?n+=`extern gfx::const_buffer_stream ${w};\r
`:n+=`const char* ${w};\r
`)}n+=`#endif // ${$}\r
\r
`,n+=`#ifdef ${j}\r
`,i.clear();for(let p=0;p<e.length;++p){const g=r[e[p]],x=H(g,u,c),w=Z(i,N(`${h}_${g.name}`)),I=l?`${w}_data`:w;if(s>0){let U;f||(U=await pe(g.svg,g.width,g.height,x.width,x.height,s));const R=s/8;let O=Math.ceil(x.width*R);n+=he(I,f?void 0:U.bitmap,l,O),n+=`\r
`,l&&(n+=`const gfx::const_bitmap<gfx::alpha_pixel<${s}>> ${w}\r
    ({${x.width}, ${x.height}}, ${I});\r
`),p<e.length-1&&(n+=`\r
`)}else{const U=new TextEncoder("utf-8").encode(g.svg).buffer;n+=oe(I,f?void 0:U,l),n+=`\r
`,l&&(n+=`gfx::const_buffer_stream ${w}\r
    ((const uint8_t*)${I}, ${g.svg.length});\r
`),p<e.length-1&&(n+=`\r
`)}}return n+=`#endif // ${j}\r
`,n},fe=(r,e,h,s,c,u,o,f)=>{let i,l;const d=A(r,e,h,s,c,u,o,f).then($=>i=$,$=>{l=$});return{read(){if(l)throw l;if(!i)throw d;return i}}},xe=r=>{let e="pending",h;const s=r.then(c=>{e="success",h=c},c=>{e="error",h=c});return{read(){if(e==="pending")throw s;if(e==="error")throw h;if(e==="success")return h}}},we=()=>{console.log("fetching icons");const r=fetch("../icons/icons.json").then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>e).catch(e=>{throw console.error("Fetch error:",e),e});return xe(r)},me=()=>!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),$e=(r,e)=>e==="C"||e===void 0||e===""?`${r}.h`:`${r}.hpp`,be=r=>r==="C"||r===void 0||r===""?"c":"cpp",je=we(),ye=()=>{P.registerLanguage("c",se),P.registerLanguage("cpp",ce);const[r,e]=C.useState(me()?K:Q),[h,s]=C.useState("C"),[c,u]=C.useState("icons"),[o,f]=C.useState("height"),[i,l]=C.useState("32"),[d,$]=C.useState("8"),[j,n]=C.useState(void 0),b=C.useRef(void 0);let p;C.useEffect(()=>{const a=y=>{e(y.matches?K:Q)},v=window.matchMedia("(prefers-color-scheme: dark)");return v.addEventListener("change",a),()=>v.removeEventListener("change",a)},[]);const g=a=>{const v=[];Object.keys(a).forEach(function(M){v.push(M)}),v.sort();const y=new Map,_=[];new DOMParser;let V=0;for(const M of v)if(M&&M.length>0){const k=a[M];let X="";if(k.search&&k.search.terms)for(let E=0;E<k.search.terms.length;++E)X+=`${k.search.terms[E]} `;const Y=Object.entries(k.svg);if(Y){for(const[E,T]of Y)if(T.raw){const re=T.raw;let F=Math.ceil(T.width);isNaN(F)&&(F=512);let D=Math.ceil(T.height);isNaN(D)&&(D=512);let S=N(M),W=E==="solid"?S:`${S}_${E}`,q=1;for(;y.has(W);)q++,W=S+q.toString(10);S=W;const J={key:S,index:V,label:k.label,name:M,width:F,height:D,svg:re,search:X};y[S]=J,_.push(J),++V}}}return _},x=a=>{n(a.target.value)},w=a=>{f(a.target.value)},I=a=>{l(a.target.value)},U=a=>{s(a.target.value)},R=a=>{u(a.target.value)},O=a=>{$(a.target.value)},L=C.useMemo(()=>g(je.read())),[m,B]=C.useState([]),te=()=>{!p&&i&&i>0&&c&&c.length>0?(console.log("generating content to clipboard"),A(L,m,c,parseInt(d),o!=="width"?parseInt(i):void 0,o==="width"?parseInt(i):void 0,h,!1).then(a=>{p=a,navigator.clipboard.writeText(p)})):p&&(console.log("writing content to clipboard"),navigator.clipboard.writeText(p))},G=()=>{const a=new Blob([p],{type:"text/plain"});b.current!=null&&b.current.length>0&&(URL.revokeObjectURL(b.current),b.current=""),b.current=URL.createObjectURL(a);const v=document.createElement("a");v.download=$e(c,h),v.href=b.current,v.click(),setTimeout(()=>{b.current&&b.current.length>0&&(URL.revokeObjectURL(b.current),b.current="")},500)},ne=()=>{!p&&i&&i>0&&c&&c.length>0?(console.log("generating content to file"),A(L,m,c,parseInt(d),o!=="width"?parseInt(i):void 0,o==="width"?parseInt(i):void 0,h,!1).then(a=>{p=a,G()})):p&&(console.log("writing content to file"),G())},ie=fe(L,m,c,parseInt(d),o!=="width"?parseInt(i):void 0,o==="width"?parseInt(i):void 0,h,!0),z=(a,v)=>{if(v.target.checked){const y=[];for(let _=0;_<m.length;++_)m[_]!==a.index&&y.push(m[_]);y.push(a.index),B(y)}else{const y=[];for(let _=0;_<m.length;++_)m[_]!==a.index&&y.push(m[_]);B(y)}};return t.jsxs(t.Fragment,{children:[t.jsx("table",{border:0,children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("label",{children:"Type:"})}),t.jsx("td",{children:t.jsxs("select",{value:h,onChange:U,children:[t.jsx("option",{value:"C",children:"Raw C/++"}),t.jsx("option",{value:"GFX2",children:"GFX 2.x"})]})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:"Module id:"}),t.jsx("td",{children:t.jsx("input",{type:"text",value:c,onChange:R})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("select",{value:o,onChange:w,children:[t.jsx("option",{value:"width",children:"width"}),t.jsx("option",{value:"height",children:"height"})]})}),t.jsx("td",{children:t.jsx("input",{type:"text",value:i,onChange:I})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("label",{children:"Bit depth:"})}),t.jsx("td",{children:t.jsxs("select",{value:d,onChange:O,children:[t.jsx("option",{value:"1",children:"Monochrome"}),t.jsx("option",{value:"2",children:"2 bits/px"}),t.jsx("option",{value:"4",children:"4 bits/px"}),t.jsx("option",{value:"8",children:"8 bits/px"}),t.jsx("option",{value:"0",children:"vector"})]})})]})]})}),i&&i>0&&c&&c.length>0&&m&&m.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:ne,className:"submit",children:"Download header file"}),t.jsx("br",{}),t.jsx("button",{onClick:te,className:"submit",children:"Copy to clipboard"})]}),t.jsx("br",{}),t.jsx("h4",{children:"Choose"}),t.jsxs("label",{children:["Filter:",t.jsx("input",{type:"text",style:{width:"100%"},onChange:x})]}),t.jsx(ee,{icons:le(L,j,m),selected:m,filter:j,clampHeight:o==="height"?i:void 0,clampWidth:o==="width"?i:void 0,iconChange:z,height:"400px"}),t.jsxs("h4",{children:["Selected ",m.length," items",d>0&&t.jsxs(t.Fragment,{children:[" (",ge(L,m,d,o!=="width"?parseInt(i):void 0,o==="width"?parseInt(i):void 0)," bytes)"]})]}),t.jsx(ee,{icons:ae(L,m),selected:m,filter:j,clampHeight:o==="height"?i:void 0,clampWidth:o==="width"?i:void 0,iconChange:z,height:"200px"}),m.length>0&&c&&c.length>0&&t.jsx(t.Fragment,{children:t.jsx(C.Suspense,{fallback:t.jsx("div",{style:{height:"400px"},children:t.jsx("h3",{children:"Loading..."})}),children:t.jsxs(t.Fragment,{children:[t.jsx("h3",{children:"Preview"}),t.jsx(ve,{syntaxTheme:r,language:be(h),gen:ie})]})})})]})},ee=r=>t.jsx("div",{id:"iconContainer",style:{borderColor:"black",borderWidth:"1px",borderStyle:"solid",backgroundColor:"white",display:"flex",flexFlow:"wrap",overflow:"auto",paddingLeft:"2%",width:"100%",height:r.height},children:t.jsx(t.Fragment,{children:r.icons.map(e=>t.jsx(ue,{clampHeight:r.clampHeight,clampWidth:r.clampWidth,icon:e,checked:r.selected.indexOf(e.index)>=0,onChange:h=>{r.iconChange(e,h)}},e.key))})}),ve=r=>{const e=r.gen.read();return t.jsx("div",{style:{height:"400px",width:"100%",overflowY:"scroll"},children:t.jsx(P,{style:r.syntaxTheme,language:r.language,children:e})})};export{ye as default};
