import{j as t,r as _}from"./main-BxNYMaPV.js";import{S as P,c as ie,a as oe,b as K,d as Z,t as N,e as ce,g as ae}from"./CGen-9Kf1BYQT.js";const le=(r,e,c)=>{const i=[];if(!e||e.length===0){for(const o of r)(!c||!c.includes(o.index))&&i.push(o);return i}for(const o of r)o.name&&(o.name.includes(e)||o.search.includes(`${e} `))&&(!c||!c.includes(o.index))&&i.push(o);return i},he=(r,e)=>{const c=[];if(e)for(const i of e)c.push(r[i]);return c},de=(r,e)=>{const c=Math.pow(2,e)-1,i=new DataView(r),o=e/8;let f=Math.ceil(i.byteLength/4*o);const a=new Uint8ClampedArray(f);let g=0,s=0,l=0;for(let d=0;d<i.byteLength;d+=4){const j=i.getUint8(d+3);if(e===8){a[g++]=j;continue}const y=j/255,m=Math.round(c*y);switch(e){case 1:{s<<=1,s|=m,++l===8&&(l=0,a[g++]=s,s=0);continue}case 2:{s<<=2,s|=m,(l+=2)===8&&(l=0,a[g++]=s,s=0);continue}case 4:{s<<=4,s|=m,(l+=4)===8&&(l=0,a[g++]=s,s=0);continue}}throw new Error("Unsupported bit depth")}return g<a.length-1&&(a[g]=s),a.buffer},ue=(r,e,c,i,o,f)=>new Promise((a,g)=>{let s=1;i&&i>0&&e>i&&(s=i/e),o&&o>0&&c*s>o&&(s=o/c);const d=new TextEncoder().encode(r),j=new Blob([d.buffer],{type:"image/svg+xml"}),y=URL.createObjectURL(j),m=new Image(Math.ceil(e*s),Math.ceil(c*s)),$=document.createElement("canvas");$.width=Math.ceil(e*s),$.height=Math.ceil(c*s);const n=$.getContext("2d");m.onload=()=>{n.drawImage(m,0,0);const v=n.getImageData(0,0,Math.ceil(e*s),Math.ceil(c*s));URL.revokeObjectURL(y),a({width:Math.ceil(e*s),height:Math.ceil(c*s),bitmap:de(v.data.buffer,f)})},m.onerror=()=>{URL.revokeObjectURL(y),g("Unable to load image")},m.src=y}),R=(r,e,c)=>{if(c&&c>0){const i=c/r.height;return{width:Math.ceil(r.width*i),height:c,scale:i}}else if(e&&e>0){const i=e/r.width;return{width:e,height:Math.ceil(r.height*i),scale:i}}else throw new Error("clampWidth or clampHeight must be specified")},fe=(r,e,c,i,o)=>{let f=0;for(let a=0;a<e.length;++a){const g=r[e[a]];!o&&!i&&(i=32);const s=R(g,o,i);f+=Math.ceil(s.width*s.height*c/8)}return f},ge=r=>{let e={flex:"auto 0 0"},c=r.clampWidth,i=r.clampHeight;!c&&!i&&(i=32);const o=R(r.icon,c,i);return e.width=`${o.width}px`,e.height=`${o.height}px`,t.jsx(t.Fragment,{children:t.jsx("div",{style:{overflow:"hidden",padding:"1% 1% 1% 1%"},children:t.jsxs("center",{children:[t.jsx("div",{dangerouslySetInnerHTML:{__html:r.icon.svg},style:e}),t.jsxs("label",{className:"inputButtonCheckLabel",style:{width:"80%",overflowY:"hidden"},children:[t.jsx("input",{type:"checkbox",className:"inputButtonCheck",checked:r.checked,onChange:r.onChange}),r.icon.label]})]})})})},W=(r,e)=>{let c=1,i=e;for(;r.has(i);)i=`${e}${++c}`;return r.set(i,i),i},V=async(r,e,c,i,o,f,a,g)=>{const s=new Map,l=a!=null&&a.length>0&&a!="C",d=N(c),j=d.toUpperCase()+(l?"_HPP":"_H"),y=l?".hpp":".h",m=d.toUpperCase()+"_IMPLEMENTATION";let $=".c/.cpp",n=`// Automatically generated by https://codewitch-honey-crisis.github.io/gfx_web/icon-pack\r
`;n+=`// #define ${m} in exactly one\r
`,l&&($=".cpp"),n+=`// translation unit (${$} file) before including this header\r
`,n+=`\r
// USAGE:\r
`,n+=`#if 0\r
`,n+=`#define ${m}\r
`,n+=`#include "${d}${y}"\r
`,n+=`#undef ${m}\r
`,n+=`#endif\r
`,n+=`#ifndef ${j}\r
`,n+=`#define ${j}\r
`,n+=`#include <stdint.h>\r
`,l&&(n+=`#include <stddef.h>\r
`,i>0?n+=`#include "gfx_pixel.hpp"\r
#include "gfx_bitmap.hpp"\r
`:n+=`#include "gfx_core.hpp"\r
#include "gfx_positioning.hpp"\r
`),n+=`\r
`,l?(i>0&&(n+=`constexpr static const size_t ${d}_bit_depth = ${i};\r
`),o&&o>0?n+=`constexpr static const uint16_t ${d}_height = ${o};\r
`:f&&f>0?n+=`constexpr static const uint16_t ${d}_width = ${f};\r
`:(o=32,n+=`constexpr static const uint16_t ${d}_height = ${o};\r
`)):(i>0&&(n+=`#define ${d.toUpperCase()}_BIT_DEPTH ${i}\r
`),o&&o>0?n+=`#define ${d.toUpperCase()}_HEIGHT ${o}\r
`:f&&f>0?n+=`#define ${d.toUpperCase()}_WIDTH ${f}\r
`:(o=32,n+=`#define ${d.toUpperCase()}_HEIGHT ${o}\r
`)),n+=`\r
`;for(let v=0;v<e.length;++v){const u=r[e[v]],x=R(u,f,o),p=W(s,N(`${c}_${u.name}`));l||(i==0?(n+=`#define ${p.toUpperCase()}_DIMENSIONS {${u.width}, ${u.height}}\r
`,n+=`#define ${p.toUpperCase()}_SCALED_DIMENSIONS {${x.width}, ${x.height}}\r
`,n+=`#define ${p.toUpperCase()}_SCALE (${x.scale})\r
`):n+=`#define ${p.toUpperCase()}_DIMENSIONS {${x.width}, ${x.height}}\r
`,n+=`#ifdef __cplusplus\r
extern "C"\r
#else\r
extern\r
#endif\r
`),i>0?(n+=`/// @brief "${u.label}" - a ${x.width}x${x.height} alpha transparency map\r
`,l?n+=`const gfx::const_bitmap<gfx::alpha_pixel<${i}>> ${p};\r
`:n+=`const uint8_t ${p}[];\r
`):(l&&(n+=`/// @brief "${u.label}" dimensions\r
`,n+=`constexpr static const gfx::sizef ${p}_dimensions(${u.width},${u.height});\r
`,n+=`/// @brief "${u.label}" scaled dimensions\r
`,n+=`constexpr static const gfx::size16 ${p}_scaled_dimensions(${x.width},${x.height});\r
`,n+=`/// @brief "${u.label}" target scale\r
`,n+=`constexpr static const float ${p}_scale = ${x.scale};\r
`),n+=`/// @brief "${u.label}" - a SVG vector icon\r
`,l?n+=`extern gfx::const_buffer_stream ${p};\r
`:n+=`const char* ${p};\r
`)}n+=`#endif // ${j}\r
\r
`,n+=`#ifdef ${m}\r
`,s.clear();for(let v=0;v<e.length;++v){const u=r[e[v]],x=R(u,f,o),p=W(s,N(`${c}_${u.name}`)),L=l?`${p}_data`:p;if(i>0){let T;g||(T=await ue(u.svg,u.width,u.height,x.width,x.height,i));const F=i/8;let M=Math.ceil(x.width*F);n+=ce(L,g?void 0:T.bitmap,l,M),n+=`\r
`,l&&(n+=`const gfx::const_bitmap<gfx::alpha_pixel<${i}>> ${p}\r
    ({${x.width}, ${x.height}}, ${L});\r
`),v<e.length-1&&(n+=`\r
`)}else{const F=new TextEncoder("utf-8").encode(u.svg).buffer;n+=ae(L,g?void 0:F,l),n+=`\r
`,l&&(n+=`gfx::const_buffer_stream ${p}\r
    ((const uint8_t*)${L}, ${u.svg.length});\r
`),v<e.length-1&&(n+=`\r
`)}}return n+=`#endif // ${m}\r
`,n},xe=(r,e,c,i,o,f,a,g)=>{let s,l;const d=V(r,e,c,i,o,f,a,g).then(j=>s=j,j=>{l=j});return{read(){if(l)throw l;if(!s)throw d;return s}}},pe=r=>{let e="pending",c;const i=r.then(o=>{e="success",c=o},o=>{e="error",c=o});return{read(){if(e==="pending")throw i;if(e==="error")throw c;if(e==="success")return c}}},we=()=>{console.log("fetching icons");const r=fetch("../icons/icons.json").then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>e).catch(e=>{throw console.error("Fetch error:",e),e});return pe(r)},$e=()=>!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),me=(r,e)=>e==="C"||e===void 0||e===""?`${r}.h`:`${r}.hpp`,je=r=>r==="C"||r===void 0||r===""?"c":"cpp",ve=we(),ye=()=>{P.registerLanguage("c",ie),P.registerLanguage("cpp",oe);const[r,e]=_.useState($e()?K:Z),[c,i]=_.useState("C"),[o,f]=_.useState("icons"),[a,g]=_.useState("height"),[s,l]=_.useState("32"),[d,j]=_.useState("8"),[y,m]=_.useState(void 0),$=_.useRef(void 0);let n;_.useEffect(()=>{const h=I=>{e(I.matches?K:Z)},b=window.matchMedia("(prefers-color-scheme: dark)");return b.addEventListener("change",h),()=>b.removeEventListener("change",h)},[]);const v=h=>{const b=[];Object.keys(h).forEach(function(k){b.push(k)}),b.sort();const I=new Map,C=[];new DOMParser;let Y=0;for(const k of b)if(k&&k.length>0){const U=h[k];let Q="";if(U.search&&U.search.terms)for(let S=0;S<U.search.terms.length;++S)Q+=`${U.search.terms[S]} `;const q=Object.entries(U.svg);if(q){for(const[S,B]of q)if(B.raw){const re=B.raw;let O=Math.ceil(B.width);isNaN(O)&&(O=512);let A=Math.ceil(B.height);isNaN(A)&&(A=512);let E=N(k),G=S==="solid"?E:`${E}_${S}`,H=1;for(;I.has(G);)H++,G=E+H.toString(10);E=G;const J={key:E,index:Y,label:U.label,name:k,width:O,height:A,svg:re,search:Q};I[E]=J,C.push(J),++Y}}}return C},u=h=>{m(h.target.value)},x=h=>{g(h.target.value)},p=h=>{l(h.target.value)},L=h=>{i(h.target.value)},T=h=>{f(h.target.value)},F=h=>{j(h.target.value)},M=_.useMemo(()=>v(ve.read())),[w,z]=_.useState([]),te=()=>{!n&&s&&s>0&&o&&o.length>0?(console.log("generating content to clipboard"),V(M,w,o,parseInt(d),a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0,c,!1).then(h=>{n=h,navigator.clipboard.writeText(n)})):n&&(console.log("writing content to clipboard"),navigator.clipboard.writeText(n))},D=()=>{const h=new Blob([n],{type:"text/plain"});$.current!=null&&$.current.length>0&&(URL.revokeObjectURL($.current),$.current=""),$.current=URL.createObjectURL(h);const b=document.createElement("a");b.download=me(o,c),b.href=$.current,b.click(),setTimeout(()=>{$.current&&$.current.length>0&&(URL.revokeObjectURL($.current),$.current="")},500)},ne=()=>{!n&&s&&s>0&&o&&o.length>0?(console.log("generating content to file"),V(M,w,o,parseInt(d),a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0,c,!1).then(h=>{n=h,D()})):n&&(console.log("writing content to file"),D())},se=xe(M,w,o,parseInt(d),a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0,c,!0),X=(h,b)=>{if(b.target.checked){const I=[];for(let C=0;C<w.length;++C)w[C]!==h.index&&I.push(w[C]);I.push(h.index),z(I)}else{const I=[];for(let C=0;C<w.length;++C)w[C]!==h.index&&I.push(w[C]);z(I)}};return t.jsxs(t.Fragment,{children:[t.jsx("table",{border:0,children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("label",{children:"Type:"})}),t.jsx("td",{children:t.jsxs("select",{value:c,onChange:L,children:[t.jsx("option",{value:"C",children:"Raw C/++"}),t.jsx("option",{value:"GFX2",children:"GFX 2.x"})]})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:"Module id:"}),t.jsx("td",{children:t.jsx("input",{type:"text",value:o,onChange:T})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("select",{value:a,onChange:x,children:[t.jsx("option",{value:"width",children:"width"}),t.jsx("option",{value:"height",children:"height"})]})}),t.jsx("td",{children:t.jsx("input",{type:"text",value:s,onChange:p})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("label",{children:"Bit depth:"})}),t.jsx("td",{children:t.jsxs("select",{value:d,onChange:F,children:[t.jsx("option",{value:"1",children:"Monochrome"}),t.jsx("option",{value:"2",children:"2 bits/px"}),t.jsx("option",{value:"4",children:"4 bits/px"}),t.jsx("option",{value:"8",children:"8 bits/px"}),t.jsx("option",{value:"0",children:"vector"})]})})]})]})}),s&&s>0&&o&&o.length>0&&w&&w.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:ne,className:"submit",children:"Download header file"}),t.jsx("br",{}),t.jsx("button",{onClick:te,className:"submit",children:"Copy to clipboard"})]}),t.jsx("br",{}),t.jsx("h4",{children:"Choose"}),t.jsxs("label",{children:["Filter:",t.jsx("input",{type:"text",style:{width:"100%"},onChange:u})]}),t.jsx(ee,{icons:le(M,y,w),selected:w,filter:y,clampHeight:a==="height"?s:void 0,clampWidth:a==="width"?s:void 0,iconChange:X,height:"400px"}),t.jsxs("h4",{children:["Selected ",w.length," items",d>0&&t.jsxs(t.Fragment,{children:[" (",fe(M,w,d,a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0)," bytes)"]})]}),t.jsx(ee,{icons:he(M,w),selected:w,filter:y,clampHeight:a==="height"?s:void 0,clampWidth:a==="width"?s:void 0,iconChange:X,height:"200px"}),w.length>0&&o&&o.length>0&&t.jsx(t.Fragment,{children:t.jsx(_.Suspense,{fallback:t.jsx("div",{style:{height:"400px"},children:t.jsx("h3",{children:"Loading..."})}),children:t.jsxs(t.Fragment,{children:[t.jsx("h3",{children:"Preview"}),t.jsx(be,{syntaxTheme:r,language:je(c),gen:se})]})})})]})},ee=r=>t.jsx("div",{id:"iconContainer",style:{borderColor:"black",borderWidth:"1px",borderStyle:"solid",backgroundColor:"white",display:"flex",flexFlow:"wrap",overflow:"auto",paddingLeft:"2%",width:"100%",height:r.height},children:t.jsx(t.Fragment,{children:r.icons.map(e=>t.jsx(ge,{clampHeight:r.clampHeight,clampWidth:r.clampWidth,icon:e,checked:r.selected.indexOf(e.index)>=0,onChange:c=>{r.iconChange(e,c)}},e.key))})}),be=r=>{const e=r.gen.read();return t.jsx("div",{style:{height:"400px",width:"100%",overflowY:"scroll"},children:t.jsx(P,{style:r.syntaxTheme,language:r.language,children:e})})};export{ye as default};
