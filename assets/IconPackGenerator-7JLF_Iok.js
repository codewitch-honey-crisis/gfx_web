import{j as t,r as _}from"./main-D6fl_qaW.js";import{S as P,c as ie,a as oe,b as K,d as Z,t as B,e as ce,g as ae}from"./CGen-C8KUZNGn.js";const le=(r,e,c)=>{const i=[];if(!e||e.length===0){for(const o of r)(!c||!c.includes(o.index))&&i.push(o);return i}for(const o of r)o.name&&(o.name.includes(e)||o.search.includes(`${e} `))&&(!c||!c.includes(o.index))&&i.push(o);return i},he=(r,e)=>{const c=[];if(e)for(const i of e)c.push(r[i]);return c},de=(r,e)=>{const c=Math.pow(2,e)-1,i=new DataView(r),o=e/8;let g=Math.ceil(i.byteLength/4*o);const a=new Uint8ClampedArray(g);let x=0,s=0,l=0;for(let d=0;d<i.byteLength;d+=4){const j=i.getUint8(d+3);if(e===8){a[x++]=j;continue}const v=j/255,n=Math.round(c*v);switch(e){case 1:{s<<=1,s|=n,++l===8&&(l=0,a[x++]=s,s=0);continue}case 2:{s<<=2,s|=n,(l+=2)===8&&(l=0,a[x++]=s,s=0);continue}case 4:{s<<=4,s|=n,(l+=4)===8&&(l=0,a[x++]=s,s=0);continue}}throw new Error("Unsupported bit depth")}return x<a.length-1&&(a[x]=s),a.buffer},ue=(r,e,c,i,o,g)=>new Promise((a,x)=>{let s=1;i&&i>0&&e>i&&(s=i/e),o&&o>0&&c*s>o&&(s=o/c);const d=new TextEncoder().encode(r),j=new Blob([d.buffer],{type:"image/svg+xml"}),v=URL.createObjectURL(j),n=new Image(Math.ceil(e*s),Math.ceil(c*s)),$=document.createElement("canvas");$.width=Math.ceil(e*s),$.height=Math.ceil(c*s);const f=$.getContext("2d");n.onload=()=>{f.drawImage(n,0,0);const u=f.getImageData(0,0,Math.ceil(e*s),Math.ceil(c*s));URL.revokeObjectURL(v),a({width:Math.ceil(e*s),height:Math.ceil(c*s),bitmap:de(u.data.buffer,g)})},n.onerror=()=>{URL.revokeObjectURL(v),x("Unable to load image")},n.src=v}),N=(r,e,c)=>{if(c&&c>0){const i=c/r.height;return{width:Math.ceil(r.width*i),height:c,scale:i}}else if(e&&e>0){const i=e/r.width;return{width:e,height:Math.ceil(r.height*i),scale:i}}else throw new Error("clampWidth or clampHeight must be specified")},fe=(r,e,c,i,o)=>{let g=0;for(let a=0;a<e.length;++a){const x=r[e[a]];!o&&!i&&(i=32);const s=N(x,o,i);g+=Math.ceil(s.width*s.height*c/8)}return g},ge=r=>{let e={flex:"auto 0 0"},c=r.clampWidth,i=r.clampHeight;!c&&!i&&(i=32);const o=N(r.icon,c,i);return e.width=`${o.width}px`,e.height=`${o.height}px`,t.jsx(t.Fragment,{children:t.jsx("div",{style:{overflow:"hidden",padding:"1% 1% 1% 1%"},children:t.jsxs("center",{children:[t.jsx("div",{dangerouslySetInnerHTML:{__html:r.icon.svg},style:e}),t.jsxs("label",{className:"inputButtonCheckLabel",style:{width:"80%",overflowY:"hidden"},children:[t.jsx("input",{type:"checkbox",className:"inputButtonCheck",checked:r.checked,onChange:r.onChange}),r.icon.label]})]})})})},W=(r,e)=>{let c=1,i=e;for(;r.has(i);)i=`${e}${++c}`;return r.set(i,i),i},V=async(r,e,c,i,o,g,a,x)=>{const s=new Map,l=a!=null&&a.length>0&&a!="C",d=B(c),j=d.toUpperCase()+(l?"_HPP":"_H"),v=d.toUpperCase()+"_IMPLEMENTATION";let n=`// Automatically generated by https://https://codewitch-honey-crisis.github.io/gfx_web/icon-pack\r
`;n+=`// #define ${v} in exactly one\r
`;let $=".c/.cpp";l&&($=".cpp"),n+=`// translation unit (${$} file) before including this header\r
`,n+=`#ifndef ${j}\r
`,n+=`#define ${j}\r
`,n+=`#include <stdint.h>\r
`,l&&(n+=`#include <stddef.h>\r
`,i>0?n+=`#include "gfx_pixel.hpp"\r
#include "gfx_bitmap.hpp"\r
`:n+=`#include "gfx_core.hpp"\r
#include "gfx_positioning.hpp"\r
`),n+=`\r
`,l?(i>0&&(n+=`constexpr static const size_t ${d}_bit_depth = ${i};\r
`),o&&o>0?n+=`constexpr static const uint16_t ${d}_height = ${o};\r
`:g&&g>0?n+=`constexpr static const uint16_t ${d}_width = ${g};\r
`:(o=32,n+=`constexpr static const uint16_t ${d}_height = ${o};\r
`)):(i>0&&(n+=`#define ${d.toUpperCase()}_BIT_DEPTH ${i}\r
`),o&&o>0?n+=`#define ${d.toUpperCase()}_HEIGHT ${o}\r
`:g&&g>0?n+=`#define ${d.toUpperCase()}_WIDTH ${g}\r
`:(o=32,n+=`#define ${d.toUpperCase()}_HEIGHT ${o}\r
`)),n+=`\r
`;for(let f=0;f<e.length;++f){const u=r[e[f]],p=N(u,g,o),w=W(s,B(`${c}_${u.name}`));l||(i==0?(n+=`#define ${w.toUpperCase()}_DIMENSIONS {${u.width}, ${u.height}}\r
`,n+=`#define ${w.toUpperCase()}_SCALED_DIMENSIONS {${p.width}, ${p.height}}\r
`,n+=`#define ${w.toUpperCase()}_SCALE (${p.scale})\r
`):n+=`#define ${w.toUpperCase()}_DIMENSIONS {${p.width}, ${p.height}}\r
`,n+=`#ifdef __cplusplus\r
extern "C"\r
#else\r
extern\r
#endif\r
`),i>0?(n+=`/// @brief "${u.label}" - a ${p.width}x${p.height} alpha transparency map\r
`,l?n+=`const gfx::const_bitmap<gfx::alpha_pixel<${i}>> ${w};\r
`:n+=`const uint8_t ${w}[];\r
`):(l&&(n+=`/// @brief "${u.label}" dimensions\r
`,n+=`constexpr static const gfx::sizef ${w}_dimensions(${u.width},${u.height});\r
`,n+=`/// @brief "${u.label}" scaled dimensions\r
`,n+=`constexpr static const gfx::size16 ${w}_scaled_dimensions(${p.width},${p.height});\r
`,n+=`/// @brief "${u.label}" target scale\r
`,n+=`constexpr static const float ${w}_scale = ${p.scale};\r
`),n+=`/// @brief "${u.label}" - a SVG vector icon\r
`,l?n+=`extern gfx::const_buffer_stream ${w};\r
`:n+=`const char* ${w};\r
`)}n+=`#endif // ${j}\r
\r
`,n+=`#ifdef ${v}\r
`,s.clear();for(let f=0;f<e.length;++f){const u=r[e[f]],p=N(u,g,o),w=W(s,B(`${c}_${u.name}`)),M=l?`${w}_data`:w;if(i>0){let E;x||(E=await ue(u.svg,u.width,u.height,p.width,p.height,i));const T=i/8;let R=Math.ceil(p.width*T);n+=ce(M,x?void 0:E.bitmap,l,R),n+=`\r
`,l&&(n+=`const gfx::const_bitmap<gfx::alpha_pixel<${i}>> ${w}\r
    ({${p.width}, ${p.height}}, ${M});\r
`),f<e.length-1&&(n+=`\r
`)}else{const T=new TextEncoder("utf-8").encode(u.svg).buffer;n+=ae(M,x?void 0:T,l),n+=`\r
`,l&&(n+=`gfx::const_buffer_stream ${w}\r
    ((const uint8_t*)${M}, ${u.svg.length});\r
`),f<e.length-1&&(n+=`\r
`)}}return n+=`#endif // ${v}\r
`,n},xe=(r,e,c,i,o,g,a,x)=>{let s,l;const d=V(r,e,c,i,o,g,a,x).then(j=>s=j,j=>{l=j});return{read(){if(l)throw l;if(!s)throw d;return s}}},pe=r=>{let e="pending",c;const i=r.then(o=>{e="success",c=o},o=>{e="error",c=o});return{read(){if(e==="pending")throw i;if(e==="error")throw c;if(e==="success")return c}}},we=()=>{console.log("fetching icons");const r=fetch("../icons/icons.json").then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>e).catch(e=>{throw console.error("Fetch error:",e),e});return pe(r)},me=()=>!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),$e=(r,e)=>e==="C"||e===void 0||e===""?`${r}.h`:`${r}.hpp`,je=r=>r==="C"||r===void 0||r===""?"c":"cpp",ve=we(),ye=()=>{P.registerLanguage("c",ie),P.registerLanguage("cpp",oe);const[r,e]=_.useState(me()?K:Z),[c,i]=_.useState("C"),[o,g]=_.useState("icons"),[a,x]=_.useState("height"),[s,l]=_.useState("32"),[d,j]=_.useState("8"),[v,n]=_.useState(void 0),$=_.useRef(void 0);let f;_.useEffect(()=>{const h=y=>{e(y.matches?K:Z)},b=window.matchMedia("(prefers-color-scheme: dark)");return b.addEventListener("change",h),()=>b.removeEventListener("change",h)},[]);const u=h=>{const b=[];Object.keys(h).forEach(function(I){b.push(I)}),b.sort();const y=new Map,C=[];new DOMParser;let Y=0;for(const I of b)if(I&&I.length>0){const L=h[I];let Q="";if(L.search&&L.search.terms)for(let U=0;U<L.search.terms.length;++U)Q+=`${L.search.terms[U]} `;const q=Object.entries(L.svg);if(q){for(const[U,F]of q)if(F.raw){const re=F.raw;let O=Math.ceil(F.width);isNaN(O)&&(O=512);let A=Math.ceil(F.height);isNaN(A)&&(A=512);let S=B(I),G=U==="solid"?S:`${S}_${U}`,H=1;for(;y.has(G);)H++,G=S+H.toString(10);S=G;const J={key:S,index:Y,label:L.label,name:I,width:O,height:A,svg:re,search:Q};y[S]=J,C.push(J),++Y}}}return C},p=h=>{n(h.target.value)},w=h=>{x(h.target.value)},M=h=>{l(h.target.value)},E=h=>{i(h.target.value)},T=h=>{g(h.target.value)},R=h=>{j(h.target.value)},k=_.useMemo(()=>u(ve.read())),[m,z]=_.useState([]),te=()=>{!f&&s&&s>0&&o&&o.length>0?(console.log("generating content to clipboard"),V(k,m,o,parseInt(d),a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0,c,!1).then(h=>{f=h,navigator.clipboard.writeText(f)})):f&&(console.log("writing content to clipboard"),navigator.clipboard.writeText(f))},D=()=>{const h=new Blob([f],{type:"text/plain"});$.current!=null&&$.current.length>0&&(URL.revokeObjectURL($.current),$.current=""),$.current=URL.createObjectURL(h);const b=document.createElement("a");b.download=$e(o,c),b.href=$.current,b.click(),setTimeout(()=>{$.current&&$.current.length>0&&(URL.revokeObjectURL($.current),$.current="")},500)},ne=()=>{!f&&s&&s>0&&o&&o.length>0?(console.log("generating content to file"),V(k,m,o,parseInt(d),a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0,c,!1).then(h=>{f=h,D()})):f&&(console.log("writing content to file"),D())},se=xe(k,m,o,parseInt(d),a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0,c,!0),X=(h,b)=>{if(b.target.checked){const y=[];for(let C=0;C<m.length;++C)m[C]!==h.index&&y.push(m[C]);y.push(h.index),z(y)}else{const y=[];for(let C=0;C<m.length;++C)m[C]!==h.index&&y.push(m[C]);z(y)}};return t.jsxs(t.Fragment,{children:[t.jsx("table",{border:0,children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("label",{children:"Type:"})}),t.jsx("td",{children:t.jsxs("select",{value:c,onChange:E,children:[t.jsx("option",{value:"C",children:"Raw C/++"}),t.jsx("option",{value:"GFX2",children:"GFX 2.x"})]})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:"Module id:"}),t.jsx("td",{children:t.jsx("input",{type:"text",value:o,onChange:T})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("select",{value:a,onChange:w,children:[t.jsx("option",{value:"width",children:"width"}),t.jsx("option",{value:"height",children:"height"})]})}),t.jsx("td",{children:t.jsx("input",{type:"text",value:s,onChange:M})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("label",{children:"Bit depth:"})}),t.jsx("td",{children:t.jsxs("select",{value:d,onChange:R,children:[t.jsx("option",{value:"1",children:"Monochrome"}),t.jsx("option",{value:"2",children:"2 bits/px"}),t.jsx("option",{value:"4",children:"4 bits/px"}),t.jsx("option",{value:"8",children:"8 bits/px"}),t.jsx("option",{value:"0",children:"vector"})]})})]})]})}),s&&s>0&&o&&o.length>0&&m&&m.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:ne,className:"submit",children:"Download header file"}),t.jsx("br",{}),t.jsx("button",{onClick:te,className:"submit",children:"Copy to clipboard"})]}),t.jsx("br",{}),t.jsx("h4",{children:"Choose"}),t.jsxs("label",{children:["Filter:",t.jsx("input",{type:"text",style:{width:"100%"},onChange:p})]}),t.jsx(ee,{icons:le(k,v,m),selected:m,filter:v,clampHeight:a==="height"?s:void 0,clampWidth:a==="width"?s:void 0,iconChange:X,height:"400px"}),t.jsxs("h4",{children:["Selected ",m.length," items",d>0&&t.jsxs(t.Fragment,{children:[" (",fe(k,m,d,a!=="width"?parseInt(s):void 0,a==="width"?parseInt(s):void 0)," bytes)"]})]}),t.jsx(ee,{icons:he(k,m),selected:m,filter:v,clampHeight:a==="height"?s:void 0,clampWidth:a==="width"?s:void 0,iconChange:X,height:"200px"}),m.length>0&&o&&o.length>0&&t.jsx(t.Fragment,{children:t.jsx(_.Suspense,{fallback:t.jsx("div",{style:{height:"400px"},children:t.jsx("h3",{children:"Loading..."})}),children:t.jsxs(t.Fragment,{children:[t.jsx("h3",{children:"Preview"}),t.jsx(be,{syntaxTheme:r,language:je(c),gen:se})]})})})]})},ee=r=>t.jsx("div",{id:"iconContainer",style:{borderColor:"black",borderWidth:"1px",borderStyle:"solid",backgroundColor:"white",display:"flex",flexFlow:"wrap",overflow:"auto",paddingLeft:"2%",width:"100%",height:r.height},children:t.jsx(t.Fragment,{children:r.icons.map(e=>t.jsx(ge,{clampHeight:r.clampHeight,clampWidth:r.clampWidth,icon:e,checked:r.selected.indexOf(e.index)>=0,onChange:c=>{r.iconChange(e,c)}},e.key))})}),be=r=>{const e=r.gen.read();return t.jsx("div",{style:{height:"400px",width:"100%",overflowY:"scroll"},children:t.jsx(P,{style:r.syntaxTheme,language:r.language,children:e})})};export{ye as default};
